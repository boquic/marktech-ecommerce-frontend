<!-- Header Principal -->
<header class="main-header">

  <!-- (Opcional) Barra Superior para Promociones / Enlaces Rápidos -->
  <div class="top-bar" *ngIf="false"> <!-- Cambia a true si la quieres usar -->
    <div class="container">
      <span>¡Ofertas Especiales! Envío gratis en pedidos superiores a $50.</span>
    </div>
  </div>

  <!-- Barra Media del Header: Logo, Menú, Búsqueda, Usuario, Carrito -->
  <div class="container header-layout middle-bar">

    <!-- Sección Izquierda: Botón de Menú y Logo -->
    <div class="header-left">
      <button class="menu-button" (click)="toggleMobileMenu()" aria-label="Abrir menú de navegación">
        <span class="material-symbols-outlined hamburger-icon">menu</span> <!-- Icono hamburguesa Material Symbols -->
        <span class="menu-text">Menú</span>
      </button>
      <a routerLink="/" class="logo-link" aria-label="Página de inicio de Marktech">
        <img src="assets/images/marktech-logo.svg" alt="Marktech Logo" class="logo-image">
        <!-- <span class="store-name-main">Marktech</span> -->
      </a>
    </div>

    <!-- Sección Central: Barra de Búsqueda -->
    <div class="search-container">
      <input type="text" class="search-input" placeholder="Buscar Productos, marcas y más..." #searchInput
             (keyup.enter)="performSearch(searchInput.value)" aria-label="Campo de búsqueda de productos">
      <button class="search-button" (click)="performSearch(searchInput.value)" aria-label="Realizar búsqueda">
        <span class="material-symbols-outlined search-icon">search</span> <!-- Icono de lupa Material Symbols -->
      </button>
    </div>

    <!-- Sección Derecha: Sesión de Usuario y Carrito -->
    <div class="header-right">
      <nav class="user-actions-nav" aria-label="Acciones de usuario">
        <ul>
          <!-- En app.component.html, dentro de <nav><ul> -->
          <li><a routerLink="/secret" routerLinkActive="active-link">Página Secreta</a></li>
          <!-- Estado de Autenticación del Usuario -->
          <ng-container *ngIf="(isAuthenticated$ | async); else showLoginPrompt">
            <li class="user-account-item dropdown-container"> <!-- 1. Contenedor con position: relative -->
              <button (click)="toggleUserDropdown($event)" class="user-account-button"[attr.aria-expanded]="isUserDropdownOpen" aria-haspopup="true" aria-label="Menú de usuario">                <span class="material-symbols-outlined icon-user">person</span> <!-- Icono de usuario Material Symbols -->
                <div class="user-info-text" *ngIf="currentUser$ | async as user">
                  <span>¡Hola, {{ user.firstName || user.username }}!</span>
                </div>
                <span class="dropdown-arrow" [class.open]="isUserDropdownOpen">▾</span>              </button>

              <!-- Menú Desplegable del Usuario -->
              <div class="user-dropdown-menu" *ngIf="isUserDropdownOpen">                <ul>
                  <li>
                    <a routerLink="/account/orders" (click)="closeUserDropdown()"> <!-- Asumiendo ruta para Mis Compras -->
                      <span class="material-symbols-outlined icon-dropdown">package_2</span> Mis Compras <!-- Icono de paquete Material Symbols -->
                    </a>
                  </li>
                  <li>
                    <a routerLink="/account/profile" class="user-account-link" aria-label="Ir a mi cuenta">
                        <span class="account-link-text">Mi Cuenta</span>
                    </a>
                  </li>
                  <hr class="dropdown-divider">
                  <li>
                    <button (click)="logoutAndCloseDropdown()" class="dropdown-logout-button">
                      <span class="material-symbols-outlined icon-dropdown">logout</span> Cerrar sesión <!-- Icono de logout Material Symbols -->
                    </button>
                  </li>
                </ul>
              </div>
            </li>
          </ng-container>

          <ng-template #showLoginPrompt>
            <li class="login-prompt-item">
              <a routerLink="/login" class="login-prompt-link" aria-label="Iniciar sesión o registrarse">
                <span class="material-symbols-outlined icon-user">person</span> <!-- Icono de usuario Material Symbols -->
                <div class="login-text-group">
                  <span>¡Hola!</span>
                  <span class="login-action-text">Inicia sesión</span>
                </div>
              </a>
            </li>
          </ng-template>

          <!-- Enlace al Carrito de Compras -->
          <li class="cart-item">
            <a routerLink="/cart" class="cart-link" aria-label="Ver carrito de compras">
              <span class="material-symbols-outlined icon-cart">shopping_cart</span> <!-- Icono de carrito Material Symbols -->
              <span class="cart-count" *ngIf="(cartItemCount$ | async) as count" [class.has-items]="count > 0">{{ count > 0 ? count : '' }}</span>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </div>

  <!-- Barra de Navegación Secundaria para Categorías Principales -->
  <nav class="secondary-navigation" aria-label="Navegación principal de categorías">
    <div class="container">
      <ul>
        <li><a routerLink="/products" routerLinkActive="active-link" [routerLinkActiveOptions]="{exact: true}">Todos los Productos</a></li>
        <li><a routerLink="/categories/ofertas" routerLinkActive="active-link">Ofertas</a></li>
        <li><a routerLink="/categories/electronicos" routerLinkActive="active-link">Electrónicos</a></li>
        <li><a routerLink="/categories/ropa" routerLinkActive="active-link">Ropa</a></li>
        <li><a routerLink="/categories/hogar" routerLinkActive="active-link">Hogar</a></li>
        <!-- Añade más enlaces a categorías principales o usa un *ngFor si vienen de una API -->
      </ul>
    </div>
  </nav>

  <!-- Menú Móvil Desplegable -->
  <div class="mobile-menu" [class.open]="isMobileMenuOpen" [attr.aria-hidden]="!isMobileMenuOpen" role="dialog" aria-modal="true" aria-labelledby="mobileMenuTitle">
    <div class="mobile-menu-header">
        <h2 id="mobileMenuTitle" class="visually-hidden">Menú Principal</h2>
        <button class="close-mobile-menu" (click)="toggleMobileMenu()" aria-label="Cerrar menú">×</button>
    </div>
    <ul>
        <li><a routerLink="/products" routerLinkActive="active-link" (click)="toggleMobileMenu()">Todos los Productos</a></li>
        <li><a routerLink="/categories/ofertas" routerLinkActive="active-link" (click)="toggleMobileMenu()">Ofertas</a></li>
        <li><a routerLink="/categories/electronicos" routerLinkActive="active-link" (click)="toggleMobileMenu()">Electrónicos</a></li>
        <li><a routerLink="/categories/ropa" routerLinkActive="active-link" (click)="toggleMobileMenu()">Ropa</a></li>
        <li><a routerLink="/categories/hogar" routerLinkActive="active-link" (click)="toggleMobileMenu()">Hogar</a></li>
        <hr>
        <ng-container *ngIf="!(isAuthenticated$ | async)">
          <li><a routerLink="/login" routerLinkActive="active-link" (click)="toggleMobileMenu()">Iniciar Sesión</a></li>
          <li><a routerLink="/register" routerLinkActive="active-link" (click)="toggleMobileMenu()">Registrarse</a></li>
        </ng-container>
        <ng-container *ngIf="isAuthenticated$ | async">
          <li><a routerLink="/account/profile" routerLinkActive="active-link" (click)="toggleMobileMenu()">Mi Cuenta</a></li>
          <li><a (click)="logoutAndCloseMenu()" class="logout-link-mobile">Cerrar Sesión</a></li>
        </ng-container>
    </ul>
  </div>
  <!-- Overlay para el menú móvil (oscurece el fondo cuando el menú está abierto) -->
  <div class="mobile-menu-overlay" [class.active]="isMobileMenuOpen" (click)="toggleMobileMenu()"></div>

</header>

<!-- Contenido Principal -->
<main class="main-content-wrapper" [class.full-page]="!showMainLayout">
  <div class="container" [class.no-container-padding]="!showMainLayout">
      <router-outlet></router-outlet>
  </div>
</main>

<!-- Footer -->
<footer class="main-footer">
  <div class="container">
    <p>© {{ currentYear }} Marktech. Todos los derechos reservados.</p>
  </div>
</footer>